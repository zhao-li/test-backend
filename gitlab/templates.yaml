.build-container:
  variables:
    ENVIRONMENT: development
    GIT_STRATEGY: fetch
    IMAGE_TAG: ${DEVELOPMENT_CONTAINER_IMAGE}
  script:
    - echo "$CI_REGISTRY_PASSWORD" |
      docker login 
        --username $CI_REGISTRY_USER
        --password-stdin
        $CI_REGISTRY
    - docker build 
        --pull
        --target $ENVIRONMENT
        --tag $IMAGE_TAG
        .
    - docker push $IMAGE_TAG

.cache-coverage:
  cache:
    key: ${CI_COMMIT_SHA}
    paths:
      - ${ARTIFACT_DESTINATION_DIR}/.coverage
    when: always

.database:
  services:
    - name: postgres:13.0
      alias: database
  variables:
    DATABASE_HOST: database
    DATABASE_PORT: 5432
    POSTGRES_DB: porter_pipeline
    POSTGRES_USER: porter_app
    POSTGRES_PASSWORD: password

