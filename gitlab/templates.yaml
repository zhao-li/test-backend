.common:
  before_script:
    #- env
    - cd $APP_DIR
    - ls -la

.build-container:
  variables:
    ENVIRONMENT: development
    GIT_STRATEGY: fetch
    IMAGE_TAG: $DEVELOPMENT_CONTAINER_IMAGE
  image: docker:19.03.12
  services:
    - docker:19.03.12-dind
  script:
    - echo "$CI_REGISTRY_PASSWORD" |
      docker login 
        --username $CI_REGISTRY_USER
        --password-stdin
        $CI_REGISTRY
    - docker build 
        --pull
        --target $ENVIRONMENT
        --tag $IMAGE_TAG
        --build-arg APP_DIR=$APP_DIR
        .
    - docker push $IMAGE_TAG

